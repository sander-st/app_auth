# Autenticaci贸n de Usuarios con Verificaci贸n por Correo

Esta aplicaci贸n es un sistema de autenticaci贸n de usuarios con caracter铆sticas como registro, inicio de sesi贸n, verificaci贸n de c贸digo, y gesti贸n de sesiones. Utiliza correos electr贸nicos de verificaci贸n para confirmar la identidad del usuario.

## Caracter铆sticas

- **Registro de usuarios**: Los usuarios pueden registrarse, y el sistema les env铆a un correo con un c贸digo de verificaci贸n.
- **Inicio de sesi贸n**: Los usuarios pueden iniciar sesi贸n despu茅s de registrarse y verificar su cuenta.
- **Cierre de sesi贸n**: Los usuarios pueden cerrar sesi贸n, y la cookie de sesi贸n ser谩 eliminada.
- **Verificaci贸n de c贸digo**: Los usuarios deben verificar su cuenta usando un c贸digo enviado a su correo.
- **Validaci贸n del token**: El middleware asegura que las rutas protegidas s贸lo son accesibles por usuarios autenticados.
- **Env铆o de correos electr贸nicos**: El sistema utiliza plantillas din谩micas para enviar correos electr贸nicos con diferentes prop贸sitos (verificaci贸n de cuenta, restablecimiento de contrase帽a, etc.).

## Tecnolog铆as utilizadas

- **Node.js**: Entorno de ejecuci贸n de JavaScript `v22.9.0`.
- **Express.js**: Framework para la creaci贸n de APIs.
- **Brevo (anteriormente Sendinblue)**: API de terceros para el env铆o de correos electr贸nicos.
- **MySQL**: Base de datos para almacenar informaci贸n de los usuarios.
- **JWT (JSON Web Tokens)**: Autenticaci贸n basada en tokens.
- **bcrypt**: Para el hashing seguro de contrase帽as.

## Instalaci贸n

1. **Clonar el repositorio**

   ```bash
   git clone https://github.com/tu-usuario/nombre-repositorio.git
   cd nombre-repositorio
   ```

2. **Instalar dependencias**

```bash
npm install
```

3. **Configurar variables de entorno**

Crea un archivo `.env` en el directorio ra铆z y agrega las siguientes variables de entorno:

```bash
PORT=3000

# mysql connect
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=your_database

# jwt key
JWT_SECRET_KEY="yoursecret"

# api key brevo
API_KEY_BREVO=your_api_key_brevo
DOMINIO_MAIL=tu_dominio_de_correo
```

4. **Inicializar la base de datos**

Aseg煤rate de que tienes una base de datos MySQL configurada y ejecuta el script SQL para crear las tablas necesarias.

5. **Iniciar la aplicaci贸n**

```bash
npm start
```

## Uso de la API

### Registro de usuarios

- **Ruta**: `/signup`
- **M茅todo**: `POST`
- **Cuerpo**:

```json
{
  "fullname": "John Doe",
  "email": "johndoe@example.com",
  "passwd": "password123"
}
```

### Verificaci贸n de c贸digo

- **Ruta**: `/validateuser`
- **M茅todo**: `PATCH`
- **Cuerpo**:

```json
{
  "code": "123456"
}
```

### Inicio de sesi贸n

- **Ruta**: `/login`
- **M茅todo**: `POST`
- **Cuerpo**:

```json
{
  "email": "johndoe@example.com",
  "passwd": "password123"
}
```

### Cierre de sesi贸n

- **Ruta**: `/logout`
- **M茅todo**: `GET`

### Verificar usuario autenticado

- **Ruta**: `/authenticate`
- **M茅todo**: `GET`
- **Requiere**: Token de autenticaci贸n (cookie `__session`)

## Middleware

`authVerifyToken`
Este middleware se asegura de que el usuario est茅 autenticado antes de permitirle acceder a rutas protegidas. Verifica la existencia y validez del token almacenado en las cookies (`__session`).

## Personalizaci贸n de correos electr贸nicos

La aplicaci贸n utiliza plantillas de correo almacenadas en el archivo `emailTemplate.js`. Actualmente, est谩 configurada para enviar correos de verificaci贸n de cuenta, y las plantillas se pueden personalizar seg煤n el tipo de correo que desees enviar.

El archivo `utils/FG.js` contiene una funci贸n `replaceTemplate` que reemplaza variables din谩micas dentro de las plantillas de correo, como el c贸digo de verificaci贸n.

## Contribuci贸n

Este proyecto est谩 abierto a contribuciones, 隆y no necesitas ser un experto para ayudar a mejorarlo! Si est谩s aprendiendo a programar, esta es una gran oportunidad para poner en pr谩ctica tus conocimientos, aprender m谩s sobre Node.js, Express, y c贸mo funciona la autenticaci贸n de usuarios.

1. **Haz un fork del proyecto**: Empieza haciendo un fork de este repositorio para tener tu propia copia.
2. **Crea una rama para tu nueva funci贸n o mejora**:
   ```bash
   git checkout -b feature/nueva-funcion
   ```
3. **Realiza tus cambios**: No dudes en probar nuevas ideas. No hay contribuciones peque帽as; mejorar la legibilidad, optimizar el c贸digo o arreglar errores siempre es valioso.
4. **Haz commits descriptivos**: Aseg煤rate de que los mensajes de tus commits expliquen claramente lo que has cambiado, siguiendo la estructura de commits de este proyecto.
5. **Env铆a un pull request**: Cuando hayas terminado, env铆a un pull request con tus cambios. Todos los pull requests son bienvenidos, no importa si es un peque帽o ajuste o una nueva caracter铆stica.

### Consejo para principiantes

Si est谩s aprendiendo como yo, colaborar en proyectos como este te ayudar谩 a mejorar tus habilidades de programaci贸n. No tengas miedo de cometer errores, ya que siempre estamos aqu铆 para aprender. Puedes empezar con peque帽as mejoras o incluso pedir ayuda si algo no est谩 claro. 隆Cada l铆nea de c贸digo cuenta!

隆Juntos podemos hacer que este proyecto sea mejor, l铆nea a l铆nea! 
